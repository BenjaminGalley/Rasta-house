<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RASTA HOUSE | WALLET</title>
    <style>
        :root { --green: #008542; --gold: #FFD100; --red: #E71D36; }
        body { background: #000; color: white; font-family: sans-serif; padding: 15px; margin: 0; }
        .back-link { color: var(--gold); text-decoration: none; font-size: 0.9rem; display: block; margin-bottom: 20px; }
        
        .balance-card { 
            background: #111; padding: 30px; border-radius: 20px; text-align: center;
            border: 2px solid var(--gold); margin-bottom: 25px;
        }
        .bal-amt { font-size: 2.5rem; font-weight: bold; color: var(--gold); display: block; margin-top: 10px; }

        .form-section { background: #111; padding: 20px; border-radius: 20px; margin-bottom: 25px; }
        .sec-title { font-weight: bold; text-transform: uppercase; margin-bottom: 15px; font-size: 1.1rem; }
        
        .instr-box { background: #000; padding: 12px; border-radius: 10px; font-size: 0.85rem; color: #aaa; margin-bottom: 15px; border-left: 4px solid #333; }
        .instr-box b { color: white; }

        input, select { 
            width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 10px; 
            border: 1px solid #333; background: #000; color: white; box-sizing: border-box;
        }
        label { font-size: 0.75rem; color: #888; margin-left: 5px; margin-bottom: 4px; display: block; }

        .btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn-dep { background: var(--green); color: white; }
        .btn-wit { background: var(--red); color: white; }
    </style>
</head>
<body>

    <a href="index.html" class="back-link">← Return to Games</a>

    <div class="balance-card">
        <small>AVAILABLE BALANCE</small>
        <span class="bal-amt" id="displayBal">0.00 ETB</span>
    </div>

    <div class="form-section">
        <div class="sec-title" style="color: var(--green);">Deposit Funds / ገንዘብ ማስገቢያ</div>
        <div class="instr-box">
            1. Transfer money to / ገንዘብ ይላኩ ወደ:<br>
            • Telebirr: <b>0988733637</b><br>
            • CBE Birr: <b>0911045825</b><br>
            2. Enter details below / ዝርዝሩን ከታች ይሙሉ
        </div>

        <select id="depMethod">
            <option value="Telebirr">Telebirr</option>
            <option value="CBE Birr">CBE Birr</option>
        </select>

        <label>AMOUNT (ETB) / መጠን</label>
        <input type="number" id="depAmount" placeholder="Min 10 ETB">

        <label>TRANSACTION ID (FROM SMS) / የትራንዛክሽን መለያ</label>
        <input type="text" id="depTxn" placeholder="e.g. 9GH567...">

        <label>SENDER FULL NAME / የላኪው ሙሉ ስም</label>
        <input type="text" id="depFromName" placeholder="Name on the receipt">

        <label>SENDER PHONE NUMBER / የላኪው ስልክ ቁጥር</label>
        <input type="tel" id="depFromPhone" placeholder="09...">

        <button class="btn btn-dep" onclick="submitDeposit()">SUBMIT DEPOSIT</button>
    </div>

    <div class="form-section">
        <div class="sec-title" style="color: var(--red);">Withdraw Funds / ገንዘብ ማውጫ</div>
        
        <select id="witMethod">
            <option value="Telebirr">Telebirr</option>
            <option value="CBE Birr">CBE Birr</option>
        </select>

        <label>AMOUNT TO WITHDRAW / ማውጣት የሚፈልጉት መጠን</label>
        <input type="number" id="witAmount" placeholder="Min 50 ETB">

        <label>RECEIVER FULL NAME / የተቀባዩ ሙሉ ስም</label>
        <input type="text" id="witToName" placeholder="Full name for transfer">

        <label>RECEIVER PHONE/ACCOUNT / የተቀባዩ ስልክ ቁጥር</label>
        <input type="tel" id="witToPhone" placeholder="09...">

        <button class="btn btn-wit" onclick="submitWithdraw()">REQUEST WITHDRAWAL</button>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzdPewsjld31mT1oBLhtCk_bkM5B_iVcaOeTMJUFMPxqgyH2bFJVYZIFTcZrPgxBrID/exec";
        let user = JSON.parse(localStorage.getItem('rasta_user') || '{"balance":0}');
        document.getElementById('displayBal').innerText = user.balance.toFixed(2) + " ETB";

        async function submitDeposit() {
            const data = {
                action: "deposit",
                playerID: user.playerID,
                method: document.getElementById('depMethod').value,
                amount: document.getElementById('depAmount').value,
                txnID: document.getElementById('depTxn').value,
                fromName: document.getElementById('depFromName').value,
                fromPhone: document.getElementById('depFromPhone').value
            };

            if(!data.amount || !data.txnID || !data.fromName || !data.fromPhone) return alert("Please fill all fields");

            await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(data) });
            alert("Deposit Request Sent! Wait for approval.");
            location.reload();
        }

        async function submitWithdraw() {
            const amt = parseFloat(document.getElementById('witAmount').value);
            const data = {
                action: "withdraw",
                playerID: user.playerID,
                method: document.getElementById('witMethod').value,
                amount: amt,
                toName: document.getElementById('witToName').value,
                toPhone: document.getElementById('witToPhone').value
            };

            if(amt > user.balance) return alert("Insufficient Balance");
            if(!amt || !data.toName || !data.toPhone) return alert("Please fill all fields");

            await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(data) });
            user.balance -= amt;
            localStorage.setItem('rasta_user', JSON.stringify(user));
            alert("Withdrawal Request Sent!");
            location.reload();
        }
    </script>
</body>
</html>
