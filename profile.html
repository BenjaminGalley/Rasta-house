<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WALLET | RASTA BET</title>
    <style>
        :root { --gold: #FFD100; --green: #008542; }
        body { background: #000; color: white; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        .bal-display { background: #111; padding: 30px; border-radius: 15px; border: 2px solid var(--gold); margin-bottom: 20px; }
        .bal-amt { font-size: 2.5rem; color: var(--gold); font-weight: bold; }
        .box { background: #111; padding: 15px; border-radius: 10px; margin-top: 15px; text-align: left; border-left: 4px solid var(--green); }
        input, select { width: 90%; padding: 12px; margin: 10px 0; border-radius: 5px; border: none; }
        .btn { background: var(--green); color: white; padding: 15px; width: 100%; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .nav-back { color: var(--gold); text-decoration: none; display: block; margin-bottom: 20px; }
    </style>
</head>
<body>
    <a href="index.html" class="nav-back">⬅ BACK TO LOBBY</a>
    
    <div class="bal-display">
        <small>YOUR BALANCE</small>
        <div class="bal-amt"><span id="u-bal">0.00</span> <small style="font-size: 1rem;">ETB</small></div>
    </div>

    <div class="box">
        <h3 style="color:var(--gold); margin-top:0;">DEPOSIT / ገንዘብ አስገባ</h3>
        <p style="font-size: 0.8rem;">1. Send money to: <b>0911223344 (Name)</b><br>2. Enter details below:</p>
        <select id="dep-method">
            <option value="Telebirr">Telebirr</option>
            <option value="CBE">CBE</option>
        </select>
        <input type="number" id="dep-amount" placeholder="Amount (ETB)">
        <input type="text" id="dep-txn" placeholder="Transaction ID / SMS Code">
        <button class="btn" onclick="submitDeposit()">SUBMIT DEPOSIT</button>
    </div>

    <div class="box" style="border-left-color: #E71D36;">
        <h3 style="color:#E71D36; margin-top:0;">WITHDRAW / ገንዘብ አውጣ</h3>
        <input type="number" id="wit-amount" placeholder="Amount to Withdraw">
        <input type="text" id="wit-acc" placeholder="Your Phone/Account Number">
        <button class="btn" style="background:#E71D36" onclick="submitWithdraw()">REQUEST WITHDRAW</button>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzdPewsjld31mT1oBLhtCk_bkM5B_iVcaOeTMJUFMPxqgyH2bFJVYZIFTcZrPgxBrID/exec";
        let user = JSON.parse(localStorage.getItem('rasta_user'));

        window.onload = () => {
            if(!user) location.href='login.html';
            document.getElementById('u-bal').innerText = parseFloat(user.balance).toFixed(2);
        };

        async function submitDeposit() {
            const data = {
                action: "deposit",
                playerID: user.playerID,
                method: document.getElementById('dep-method').value,
                amount: document.getElementById('dep-amount').value,
                txnID: document.getElementById('dep-txn').value
            };
            await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(data) });
            alert("Deposit submitted! Wait for Admin approval.");
            location.reload();
        }

        async function submitWithdraw() {
            const amt = document.getElementById('wit-amount').value;
            if(amt > user.balance) return alert("Insufficient Balance");
            const data = {
                action: "withdraw",
                playerID: user.playerID,
                method: "Telebirr",
                amount: amt,
                account: document.getElementById('wit-acc').value
            };
            const res = await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(data) });
            alert("Withdrawal requested. Balance deducted.");
            user.balance -= amt;
            localStorage.setItem('rasta_user', JSON.stringify(user));
            location.reload();
        }
    </script>
</body>
</html>
